# 物联网无线通信

# 1 概述

物联网产业关注的核心要素：全面感知，可靠传送，智能处理

射频：在空间中进行有效辐射的电磁波频率

微波：经常使用的波段，微波指的是频率300MHz-3000GHz的电磁波

> 微波的频率极高，波长又很短，其在空中的传播特性与光波相近，也就是直线前进，遇到阻挡就被反射或被阻断，因此微波通信的主要方式是**视距通信**，超过视距以后需要中继转发。 

有线通信：串口，USB，网口

无线通信：蜂窝无线连接，WiFi

短距离通信：RFID，NFC（属于RFID中的一种，工作频率13.56MHz），蓝牙（点对点通信，组网能力差），Zigbee，WiFi

> RFID应用：身份证，校园卡，NFC，车钥匙，ETC，防伪，图书

长距离通信：NB-IoT，LoRa

# 2 通信原理

## 2.1 通信的概念

通信：信息**传输**、**处理**和**再现**信息的过程。它涉及信息的发送者、接收者和传输媒体。

> 【雨课堂】
>
> - 通信目的：[传输消息中所包含的信息]
>
> - 信息是消息的 [内涵]，消息是信息的 [表现形式]，信号是消息的 [传输载体] 

模拟信号：取值连续（无穷多）

数字信号：取值离散（有限个）

## 2.2 通信系统的组成

通信系统一般模型：信源，发送设备，信道，接收设备，信宿

发送设备的两大任务：调制和放大

> 将低频的基带信号装载到高频信号上（调制），用天线发送出去

接收设备的三大任务：选频，放大，解调

> 传输中会受到很大的衰减，能量损失较大，需要经过放大器

基带信号：来自信源的消息信号（原始电信号，也称调制信号）

载波信号：未受调制的高频振荡信号

已调信号：受到调制后的已调载波信号

> 【雨课堂】
>
> 调制的目的：
>
> - 将基带信号转换为适合信道传输的信号
> - 便于电磁波辐射接收
> - 便于频分多路复用
> - 提高抗干扰能力

通信系统分类：

- 模拟通信系统

模拟信源，调制器，信道，解调器，信宿

- 数字通信系统

![image-20230531153816605](README/image-20230531153816605.png)

> 【雨课堂】
>
> 数字通信系统的优缺点：
>
> 优点：
>
> - 抗干扰能力强，无噪声积累
> - 便于加密处理
> - 易于实现集成化，使通信设备体积小，功耗低
> - 利于采用时分复用实现多路通信
> - 传输差错可控
> - 便于处理，变换，存储
>
> 缺点：
>
> - 需要较大的传输带宽
> - 对同步要求高

## 2.3 通信系统的分类

按复用方式分为：频分，时分，码分复用

## 2.4 通信方式

按传输方向划分：单工通信，半双工通信，全双工通信

按数字码元传输时序分：并行传输，串行传输

## 2.5 信息及其度量

信息量 $I$ 与消息出现的概率 $P(x)$ 之间的关系为：
$$
I = log_a \frac{1}{P(x)} = - log_a(P(x))
$$

>$a = 2$ 时，信息量的单位是比特（bit）
>
>$a = e$ 时，信息量的单位是奈特（nit）
>
>$a = 10$ 时，信息量的单位是哈特莱

信息源的熵：
$$
H = - \sum \limits _{i = 1} ^n P(x_i) log_2 P(x_i) 
$$

> 当每个符号等概率独立出现时，信源的熵有最大值，单位为`bit/符号`



>【课件例题】
>
>![image-20230531161817066](README/image-20230531161817066.png)
>$$
>(log_a (x))' = \frac{1}{x ln a}
>$$

>
>![image-20230531161853930](README/image-20230531161853930.png)
>
>【雨课堂】
>
>四进制信源（0，1，2，3），$P(0) = \frac{3}{8}, P(1) = P(2) = \frac{1}{4}, P(3) = \frac{1}{8}$ ，求信源平均信息量
>
>![image-20230531162152665](README/image-20230531162152665.png)

## 2.6 通信系统的主要性能指标

可靠性：传输的质量问题

有效性：传输的速度问题

- 模拟通信系统：

有效性：用有效传输频带度量

可靠性：用接收端的最终输出信噪比来度量

- 数字通信系统：

有效性：用传输速率和频带利用率来度量

码元传输速率： $R_B = \frac{1}{T}, T:一个码元持续的时间$ 单位为 B（波特）

信息传输速率： $R_b = R_B log_2 M$ 若为二进制信号，`M=2`，八进制信号，`M=8`，单位`bit/s`

>【雨课堂】
>
>二进制传输系统上每秒传输1000个二进制符号，若符号0,1出现的概率分别为1/4、3/4，则该系统的信息传输速率是多少？
>
>符号信息熵为 $H = -\frac{1}{4}log_2{\frac{1}{4}} - \frac{3}{4}log_2{\frac{3}{4}} = 0.811 bit$  `答案是0.415，我不知道为什么`
>
> 符号的传输时间为 $T=1/1000$ 秒
>
>系统的信息传输速率为  $R_b=H/T=811bit/s$

频带利用率： $\frac{R_B}{B} 或 \frac{R_b}{B}$ ，B为带宽

可靠性：用误码率和误信率来度量

误码率 = 传输错误码元数 / 总码元数

误信率 = 错误比特数 / 总比特数

二进制中，两者相等

> 【有例题】请看课件

## 2.7 信息容量

香农公式：
$$
C = B log_2(1 + \frac{S}{N}) \\
eg. \ 30dB = 10lg(\frac{S}{N})
$$


信道容量必须大于等于 $R_b$

> 【有例题】请看课件
>
> 【雨课堂】
>
> 有一显示器终端连接计算机系统，用一条电话线路连接，电话线路带宽3000Hz，信噪比为10dB，终端有128个印刷字符，终端输出字符是相互独立且等概的，求最大的字符速率是？
>
> ![image-20230531173511273](README/image-20230531173511273.png)

# 3 数字带通传输

## 3.1 概述

方法：

- 模拟调制法
- 数字键控法

## 3.2 二进制数字调制和解调原理

> 【雨课堂】
>
> 2ASK：二进制振幅键控
>
> 2FSK：二进制频移键控
>
> 2PSK：二进制相移键控
>
> 2DPSK：二进制差分相移键控

## 3.3 二进制数字调制系统的性能比较

- 误码率

> 【雨课堂】
>
> - 采用相同解调方式， $r$ （信噪比） 一定，抗高斯白噪声的性能优劣顺序：
>
> 2PSK、2DPSK、2FSK、2ASK（比较误码率）
>
> - 为保证相同的误码率，2ASK、2FSK、2PSK这三种数字调制方式所需的信噪比之间是什么关系？
>
> $r_{2ASK} = 2r_{2FSK} = 4r_{2PSK}$

$r$ 一定，相同的调制方式，误码率：
$$
P_{e相干} \lt P_{e非相干}
$$

- 频带带宽

2FSK对频带利用率最低，有效性最差

- 对信道特性变化的敏感性

>【雨课堂】
>
>对信道特性变化最为敏感：2ASK， $2ASK \gt 2PSK \gt 2FSK$

- 设备复杂度

非相干方式比相干方式简单

## 3.4 多进制数字调制原理和特点

MASK，MPSK，MFSK

> 【雨课堂】 
>
> - 正交振幅调制是一种[振幅]和[相位]联合键控的数字调制技术
>
> - 扩频通信技术：
>
> 根据香农公式可知，在给定的信道容量C不变的情况下，可以通过增加频带宽度的方法，在较低的信噪比（S/N）情况下以相同的信息速率来可靠的传输信息，甚至是在信号被噪声淹没的情况下，只要相应地增加信号带宽，仍然能够保证可靠的通信。 扩展频谱以换取对信噪比要求的降低

# 4 天线与电波传输

## 4.1 无线电波基本知识

无线电波是一种能量传递的形式

无线电波的参数：波速度，波长，极化（电场强度E的矢端在空间固定点上随时间的变化所描绘的轨迹。）
$$
\lambda = VT = \frac{V}{f}
$$


极化：

- 线极化（电场强度矢量端点的轨迹是一条直线）
  - 水平极化（与地面平行）
  - 垂直极化（与地面垂直）
- 圆极化
- 椭圆极化

> 【雨课堂】
>
> - 收发信号要求极化相同。
>
> 若发射天线采用垂直极化，则接收天线一般情况下应采用垂直极化。
>
> - 什么是电磁波的极化：电场强度E的矢端在空间固定点上随时间的变化所描绘的轨迹
> - 垂直极化波的电场方向与地面垂直，水平极化波的电场方向与地面平行
> - 电磁波的波长与频率成反比例

## 4.2 天线基本知识

天线：能够进行能量转换即有效地辐射和接收电磁波的装置

天线必须解决的三个问题：

- 提高辐射功率或信噪比
- 具有向所需方向辐射电磁波的能力
- 中、收、发天线应有相同的极化形式

天线导波原理：载有交流电的导线，其辐射能力与导线的长短和形状有关

将能产生显著辐射的直导线成为振子

振子类型：

- 对称振子：两臂长度相等的振子
- 半波振子：每臂长度为四分之一波长
- 全波对称振子：全长与波长相等

> 【雨课堂】
>
> 半波振子天线每臂的长度为波长的 [四] 分之一

双极化天线比单极化天线接受范围更大，损失小，效果更好

天线的方向性的特性曲线通常用天线方向图来表示。

天线增益：在输入功率相等的条件下，实际天线与理想的辐射单元在空间同一点处所产生的信号的功率密度之比。

天线的工作频率范围：工作在中心频率时天线所能输送的功率最大，偏离中心频率时它所输送的功率都将减小

RF功率单位：W（绝对功率）

分贝（dB）是用于测量两个信号相对强度（比率）的单位

> Bm是相对于1mW的强度

转换等式：
$$
x(dbm) = 10 lg \ y(mW) \\
y(mW) = 10 ^{x(dBm) / 10}
$$

>【雨课堂】
>
>- 某无线通信模块的发射功率和接收灵敏度分别为12dBm和-132dBm ，将上述功率转换为mW
>
>$$
>10 ^ {12 / 10} = 15.8 mW\\
>10 ^ {-132 / 10} = 6.3 \times 10 ^ {-14} mW
>$$
>
>- 某同学需要选择一个 天线 用于蓝牙通信系统，他应该关注天线的哪些参数？
>
>1.极化方式
>
>2.工作频率范围
>
>3.天线方向图
>
>4.天线增益

## 4.3 电波传播特性

电波传播方式：直射波，反射波，绕射波，散射波

自由空间传播：均匀无损耗的无限大空间，其电波传播具有各向同性

自由空间特点：电波传播时能量不会被障碍物吸收、反射、散射而产生损耗

自由空间损耗的根本原因：能量扩散

> 球面波在传播过程中，随着传播距离增大，球面单位面积上的能量减小了，而接收天线的有效截面积是一定的，因而接收天线所捕获的信号功率减小了，这就是自由空间损耗。

自由空间传播损耗：
$$
L_{fs}(dB) = 32.44 + 20 lg \ d (Km) + 20 lg \ f(MHz)
$$
结论：自由空间中电波传播损耗只与工作频率和传播距离有关。

自由空间传播适用范围：只要地面上空的大气层是各向同性的均匀媒质，其传播路径上没有障碍物的阻挡，到达接收天线的地面反射信号场强也可以忽略不计，这样情况下，电波可视作在自由空间中传播。

接收功率
$$
P_R(dBm) = P_T(dBm) + G_T(dB) + G_R(dB) - L_{fs}(dB)
$$

> 【例题】
>
> ![image-20230602162826024](README/image-20230602162826024.png)
>
> ![image-20230602163134536](README/image-20230602163134536.png)
>
> 【雨课堂】
>
> ![image-20230602163823097](README/image-20230602163823097.png)
> $$
> P_R = -150 \\
> L_{b} = 套公式 \\
> P_R(dBm) = P_T(dBm) + G_T(dB) + G_R(dB) - L_{b}(dB) \\
> 可以求出 P_T
> $$
>
> - 室内环境下，电波传播距离很近时，传输损耗非常接近自由空间的情况，其计算公式为：
>
> $$
> L_{fs}(dB) = 32.44 + 20 lg \ d(kM) + lg f(MHz)
> $$
>
> 试计算某2.4GHz信号，在距离分别为d=1m，d=2m，d=5m时的传播损耗。
>
> 带公式就行

# 5 蓝牙通信技术

## 5.1 蓝牙技术的概论

蓝牙技术：一种近距离的保证可靠接收和信息安全的无线通信技术

蓝牙芯片可满足：

- 在10m范围内实现一点对多点的通信；

- 满足一定的数据传输速率；

- 使用频段2.4GHz；

- 要求成本低廉，价格与所取代的电缆线基本持平。

> 【雨课堂】
>
> - 蓝牙工作频率为[2.4GHz]
> - 蓝牙通信技术的特点：
>   - 全球范围适用
>   - 可建立临时对等连接
>   - 很好的抗干扰能力和安全性
>   - 功耗低，体积小
>   - 近距离通信
>   - 同时传输语音数据

## 5.2 蓝牙技术协议体系结构

蓝牙协议采用分层结构，遵循OSI参考模型。

> OSI模型：应用层，表示层，会话层，传输层，网络层，数据链路层，物理层

蓝牙协议体系可分为：底层协议，中间层协议，高端应用层协议

底层协议：射频（RF）协议，基带（BB）协议，链路管理协议（LMP）

>射频(RF)协议：主要定义频段与信道安排、发射/接收机特性等
>
>基带(BB)协议：为基带数据分组提供同步定向连接(Synchronous  Connection Orented，SCO)和异步无连接(Asynchronous  Connectionless，ACL)两种物理链路，对不同数据类型都会分配一个 特殊信道，用于传递连接管理和控制信息等
>
>链路管理协议(LMP)：主要负责蓝牙设备间连接的建立、拆除和安全控制，控制无线设备的节能模式和工作周期，以及微微网内各设备单元的连接状态。

中间层协议

主机控制器接口(HCI)协议：位于L2CAP和LMP之间，为上层协议提供进入LMP和BB的统一接口和方式。HCI传输层包括：USB、RS232、UART和PC 卡。

逻辑链路控制与适配协议(L2CAP)：主要完成数据的拆装、服务质量控制，协议的复用、分组的分割和重组及组管理等功能。

串口仿真协议(RFCOMM)：又称线缆替换协议，仿真RS-232的控制和数据信号，可实现设备间的串行通信，为使用串行线传送机制的上层协议提供服务。

电话控制协议(TelCtrl)：包括电话控制规范二进制(TCS-BIN)协议和A/T命令集电话控制命令。

服务发现协议(SDP)：为上层应用程序提供一种机制来发现可用的服务，是所有用户模式的基础。

蓝牙设备主要运行在待机和连接两种状态。

> 待机：蓝牙默认的工作状态，每隔1.28s周期性侦听信息，一旦被唤醒，就处于连接状态
>
> 连接：连接建立后，可处于激活，保持，呼吸，休眠4种模式，功耗由低到高为休眠，保持，呼吸
>
> 【雨课堂】
>
> 蓝牙设备连接后，处于哪种状态功耗最低？
>
> 休眠状态

蓝牙的网络结构：微微网（个人局域网），散射网

微微网是蓝牙基本的组网方式，散射网由多个微微网组成

同一个微微网中：

- 一个蓝牙设备可以同时与最多7个其他蓝牙设备相连

- 各单元之间共享一个信道

- 有且只有一个主单元，其余为从单元

- 主单元控制微微网从建立到数据传送到最后结束通信的整个过程

## 5.3 蓝牙网络结构

微微网：1台主设备和1台以上从设备构成的网络称为微微网

> 在一个微微网中最多可有七个活动**从设备**。另外，更多的**从设备**被锁定在休眠状态中。在同一个微微网中，主设备为所有的从设备提供时钟和跳频同步序列。
>
> 在同一个微微网中，所有的设备有同样的跳频序列。
>
> 【雨课堂】
>
> 一个蓝牙微微网的主设备，最多可以连接 [七] 个处于活动状态的从设备。

微微网中，所有设备的级别是相同的，具有相同的权限

每个微微网都有独立的跳频序列，微微网间不会发生跳频同步，无同频干扰。

散射网：散射网是由多个独立的非同步的微微网组成的，比单一微微网覆盖更多设备，更大范围

- 一个设备不能同时担任两个微微网的主设备。

- 不同微微网之间有互联的桥接设备，桥接设备可以由主设备或从设备充当。

## 5.4 蓝牙模块

目前多数蓝牙芯片底层硬件采用单芯片结构

蓝牙模块：在蓝牙芯片的基础上，添加天线、晶振、电源电路等，并根据应用需求开发所需的应用协议、应用程序和接口驱动程序，即可构成蓝牙模块

蓝牙性能指标：发射功率，接受灵敏度，通信距离，功耗与电流

模块主要特点：

- 支持主从一体（主从可通过硬件和AT指令切换）
- 内置SPI编程接口

蓝牙串口模块：发送端TXD连接另一台设备的接收端RXD

> 【雨课堂】
>
> 蓝牙串口模块与USB转TTL模块电气连接后并与上位机相连，如果在串口调试助手的发送界面输入“AT”后没有反馈“OK”，则可以尝试使用哪些步骤解决该问题？
>
> (1) 检查硬件连接，即蓝牙模块的TXD是否与USB转TTL模块的RDX进行连接，蓝牙模块的RDX是否与USB转TTL模块的TXD进行连接。
>
> (2) 检查USB转TTL模块的驱动是否正确安装，PC端的操作系统是否能正确识别连接的端口号。
>
> (3) 检查串口调试小助手的端口号是否设置正确，是否单击了“打开串口”按钮。
>
> (4) 串口调试小助手的命令栏内的“AT”后面是否加“回车”按键。

## 5.5 蓝牙应用开发

AT指令：早期AT指令多用于GSM、GPRS模块

蓝牙模块和WiFi模块支持AT指令

AT指令分为下行命令和上行命令，下行命令是PC发给模块的，上行命令是模块上报给PC的。

## 5.6 蓝牙应用领域

数据传输领域

语音传输领域

医疗保健领域

智能家居领域
